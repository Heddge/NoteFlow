@page
@using NoteFlow.Pages;
@using NoteFlow.Services;
@using NoteFlow.Helpers;
@model NoteFlow.Pages.MainScreenModel;
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] MainScreen</title>
    <link rel="stylesheet" href="~/css/MainScreen.css" />
</head>

<body>


    <!-- Кнопка настроек
    <button class="settings-btn" onclick="openSettings()">Настройки</button> -->

    <!-- Кнопка домой
    <button class="home-btn" onclick="goHome()">Домой</button> -->

    <!-- Всплывающее окно -->
    <div id="devModal" class="dev-modal">
        <div class="dev-modal-content">В разработке...</div>
    </div>
    <div id="devModalOverlay" class="dev-modal-overlay"></div>

    <button id="toggleSidebarBtn" class="toggle-sidebar-btn">
        <div class="toggle-icon">
            <div class="toggle-icon-line"></div>
            <div class="toggle-icon-line"></div>
            <div class="toggle-icon-line"></div>
        </div>
    </button>

    
    <!-- Надпись напоминания-->
    <div class="reminder-title">Напоминания</div>
    
    <div class="add-text">
        <strong>
            <h1 class="add-text">Greetings</h1>
        </strong>
    </div>

    <nav class="top-bar">
        <div class="logo-container">
            <img src="/Images/Logo.png" class="logo" alt="NoteFlow" />
        </div>

        <div class="top-bar-actions">
            @if (PlatformHelper.IsMacOS)
            {
                <!-- macOS стиль - кнопки слева -->
                <div class="top-bar-actions macos-buttons">
                    <button class="nav-buttons close-btn" title="Закрыть" id="closeBtn">
                        <svg width="12" height="12" viewBox="0 0 12 12">
                            <circle cx="6" cy="6" r="6" fill="#FF5F57" />
                        </svg>
                    </button>
                    <button class="nav-buttons" title="Свернуть" id="minimizeBtn">
                        <svg width="12" height="12" viewBox="0 0 12 12">
                            <circle cx="6" cy="6" r="6" fill="#FFBD2E" />
                        </svg>
                    </button>
                    <button class="nav-buttons" title="Развернуть" id="maximizeBtn">
                        <svg width="12" height="12" viewBox="0 0 12 12">
                            <circle cx="6" cy="6" r="6" fill="#28CA42" />
                        </svg>
                    </button>
                </div>
            }
            else
            {
                <div class="top-bar-actions windows-buttons">
                    <button class="nav-buttons" title="Перезагрузить" id="reloadBtn">
                        <svg width="32" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M23 4v6h-6M1 20v-6h6" stroke-width="2" stroke-linecap="round" />
                            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15" stroke-width="2"
                                stroke-linecap="round" />
                        </svg>
                    </button>
                    <button class="nav-buttons" title="Свернуть" id="minimizeBtn">
                        <svg width="32" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M5 12h14" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                    <button class="nav-buttons" title="Развернуть" id="maximizeBtn">
                        <svg width="32" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="3" y="3" width="18" height="18" rx="2" stroke-width="2" />
                        </svg>
                    </button>
                    <button class="nav-buttons close-btn" title="Закрыть" id="closeBtn">
                        <svg width="32" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M18 6L6 18M6 6l12 12" stroke-width="2" stroke-linecap="round" />
                        </svg>
                    </button>
                </div>
            }
        </div>

    </nav>
    <!-- Надпись "Недавние файлы" -->
    <div class="recent-files-label">Недавние файлы</div>

    <!-- Обертка для контейнера с блюром -->
    <div class="cards-container-wrapper">
        <div class="blur">
            <img src="/Images/blur.png" alt="NoteFlow" />
        </div>
        <!-- Контейнер для карточек заметок -->
        <div class="cards-container">
            <!-- Карточка добавления заметки -->
            <form method="post">
                <button type="submit" asp-page-handler="ToEditorForEditOrCreate" name="path" value=""
                    class="card-button">
                    <div class="card-bg">
                        <div class="add-note-text">Добавить заметку</div>
                    </div>
                </button>
            </form>

            <!-- Карточки заметок -->
            @if (Model.Notes.Count() > 0)
                @for (int i = 0; i < Model.Notes.Count(); i++)
                {
                    <form method="post" asp-page-handler="ToEditorForEditOrCreate">
                        <input type="hidden" name="path" value="@Model.Notes[i].NotePath"/>
                        <button type="submit" class="note-card">
                            <div class="note-card-bg">
                                <div class="note-icon">&lt;/&gt;</div>
                                <div class="note-title">@Model.Notes[i].NoteTitle</div>
                                <div class="note-description">@Html.Raw(Model.Notes[i].NoteContent)</div>
                                <div class="note-timestamp">@Model.Notes[i].BeatifulCreationDate()</div>
                            </div>
                        </button>
                    </form>
                }
        </div>
    </div>


<!-- Контейнер для напоминаний -->
<div class="reminders-container">
    <div class="blur">
        <img src="/Images/blur.png" alt="NoteFlow" />
    </div>
    
    <div class="cards-container">
        <!-- Карточка нового напоминания -->
        <div class="card" onclick="showDevModal()">
            <div class="card-bg">
                <div class="add-note-text">Добавить напоминание</div>
            </div>
        </div>

        <div class="wide-reminder-card">
            <div class="wide-reminder-bg gradient-border" onclick="showDevModal()">
                <!-- Время и дата посередине сверху -->
                <div class="reminder-time-header-container">
                    <div class="reminder-date">Сегодня</div>
                    <div class="reminder-time">10:45</div>
                </div>
                
                <!-- Основной контент (без emoji) -->
                <div class="reminder-content-box">
                    <div class="reminder-main-text">Покормить кота</div>
                    <div class="reminder-description-text">Купить корм для кота, покормить его</div>
                </div>
                
                <!-- Линия и время создания внизу -->
                <div class="reminder-created-time-container">
                    <div class="reminder-divider-line"></div>
                    <div class="reminder-created-time">Вчера 21:45</div>
                </div>
            </div>
        </div>
    </div>
</div>




    <!-- Календарь -->
    <div class="calendar-section-title" >Календарь</div>
    <div class="calendar-section-wrapper">
        <div class="calendar-container gradient-border" onclick="showDevModal()">
            <div class="calendar-content">
                <div class="calendar-left">
                    <div class="calendar-current-date">Октябрь 31</div>
                    <div class="calendar-reminder-card">
                        <div class="calendar-reminder-title">Покормить кота</div>
                        <div class="calendar-reminder-description">Купить корм для кота, покормить его</div>
                    </div>
                </div>

                <div class="calendar-compact gradient-border">
                    <div class="calendar-header-compact">
                        <div class="calendar-nav">
                            <div class="calendar-month-year">October 2025</div>
                            <button class="calendar-nav-btn">&lt;</button>
                            <button class="calendar-nav-btn">&gt;</button>
                        </div>
                    </div>

                    <div class="calendar-week-days-compact">
                        <div class="calendar-week-day">SUN</div>
                        <div class="calendar-week-day">MON</div>
                        <div class="calendar-week-day">TUE</div>
                        <div class="calendar-week-day">WED</div>
                        <div class="calendar-week-day">THU</div>
                        <div class="calendar-week-day">FRI</div>
                        <div class="calendar-week-day">SAT</div>
                    </div>

                    <div class="calendar-days-grid">
                        <div class="calendar-day empty"></div>
                        <div class="calendar-day empty"></div>
                        <div class="calendar-day empty"></div>
                        <div class="calendar-day">1</div>
                        <div class="calendar-day">2</div>
                        <div class="calendar-day">3</div>
                        <div class="calendar-day">4</div>

                        <div class="calendar-day">5</div>
                        <div class="calendar-day">6</div>
                        <div class="calendar-day">7</div>
                        <div class="calendar-day">8</div>
                        <div class="calendar-day">9</div>
                        <div class="calendar-day">10</div>
                        <div class="calendar-day">11</div>

                        <div class="calendar-day">12</div>
                        <div class="calendar-day">13</div>
                        <div class="calendar-day">14</div>
                        <div class="calendar-day">15</div>
                        <div class="calendar-day">16</div>
                        <div class="calendar-day">17</div>
                        <div class="calendar-day">18</div>

                        <div class="calendar-day">19</div>
                        <div class="calendar-day">20</div>
                        <div class="calendar-day">21</div>
                        <div class="calendar-day">22</div>
                        <div class="calendar-day">23</div>
                        <div class="calendar-day">24</div>
                        <div class="calendar-day">25</div>

                        <div class="calendar-day">26</div>
                        <div class="calendar-day">27</div>
                        <div class="calendar-day">28</div>
                        <div class="calendar-day">29</div>
                        <div class="calendar-day">30</div>
                        <div class="calendar-day current">31</div>
                        <div class="calendar-day empty"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { ipcRenderer } = require('electron');

        document.getElementById('minimizeBtn')?.addEventListener('click', () => {
            ipcRenderer.send('minimize-window');
        });

        document.getElementById('maximizeBtn')?.addEventListener('click', () => {
            ipcRenderer.send('maximize-window');
        });

        document.getElementById('closeBtn')?.addEventListener('click', () => {
            ipcRenderer.send('close-window');
        });

        document.getElementById('reloadBtn')?.addEventListener('click', () => {
            location.reload();
        });

    @*function openSettings() {
            console.log('Открыть настройки');
            window.location.href = '/Settings';
        }*@

            function goHome() {
                console.log('Возврат на главный экран');
                window.location.href = '/MainScreen';
            }

        //Перехват скролла чтобы скроллить колесиком
        const cardsContainer = document.querySelector('.cards-container');

        cardsContainer.addEventListener('wheel', function (e) {
            // Предотвращаем вертикальный скролл страницы
            if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
                e.preventDefault();

                // Настройки скролла
                const scrollSpeed = 2; // Скорость скролла
                const maxScroll = this.scrollWidth - this.clientWidth;

                // Рассчитываем новую позицию
                let newScrollLeft = this.scrollLeft + (e.deltaY * scrollSpeed);

                // Ограничиваем скролл в пределах контейнера
                newScrollLeft = Math.max(0, Math.min(maxScroll, newScrollLeft));

                // Плавный скролл
                this.scrollTo({
                    left: newScrollLeft,
                    behavior: 'smooth'
                });
            }
        }, { passive: false });


        const devModal = document.getElementById('devModal');
        const devModalOverlay = document.getElementById('devModalOverlay');
        // Показать модальное окно "В разработке"
        function showDevModal() {
            devModal.style.display = 'block';
            devModalOverlay.style.display = 'block';
        }

        // Закрытие окна по клику на оверлей
        devModalOverlay.addEventListener('click', function () {
            devModal.style.display = 'none';
            devModalOverlay.style.display = 'none';
        });

        // Закрытие окна по Escape
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                devModal.style.display = 'none';
                devModalOverlay.style.display = 'none';
            }
        });
    </script>

</body>
